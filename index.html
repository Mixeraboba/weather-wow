<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–≥–æ–¥–∞</title>
    <link rel="icon" href="https://emojigraph.org/media/messenger/sun_2600-fe0f.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: url('https://distribution.faceit-cdn.net/images/06b14bb6-3d10-4992-82db-557be5a07687.jpeg');
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
        .ebash {
            background: #ff4444;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
        }
        .ebash:hover {
            background: #cc0000;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç –ü–æ–≥–æ–¥–∞ –ø–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é</h1>
        
        <button onclick="getLocation()">üìç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
        
        <div id="place" class="status info">
            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
        </div>
        
        <h4 id="weatherD"></h4>
        <h4 id="temp"></h4>
        <h4 id="feels_li"></h4>

    </div>

    <script>

        
        
        const apiKey = 'f85315666ea138adc5946ff3138e9e02';
        let currentLat = null;
        let currentLon = null;

        function getLocation() {
            const placeElement = document.getElementById('place');
            placeElement.innerHTML = '<div class="status info">üïê –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...</div>';

            if (!navigator.geolocation) {
                placeElement.innerHTML = '<div class="status error">‚ùå –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</div>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    currentLat = position.coords.latitude;
                    currentLon = position.coords.longitude;
                    
                    placeElement.innerHTML = `<div class="status success">‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!</div>`;
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ Telegram —á–µ—Ä–µ–∑ Google Apps Script
                    
                    getLocationName(currentLat, currentLon);
                },
                function(error) {
                    let errorMessage = '‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                            break;
                        case error.TIMEOUT:
                            errorMessage += '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
                            break;
                        default:
                            errorMessage += '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    }
                    placeElement.innerHTML = `<div class="status error">${errorMessage}</div>`;
                }
            );
        }
    
            
    

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        function getLocationName(lat, lon) {
            fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&lang=ru&appid=${apiKey}`)
                .then(response => response.json())
                .then(locationData => {
                    if (locationData && locationData.length > 0) {
                        const location = locationData[0];
                        const cityName = location.local_names?.ru || location.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç';
                        const country = location.country || '';   
                        
                        document.getElementById('place').innerHTML += 
                            `<div class="status success">üèôÔ∏è –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${cityName}${country ? ', ' + country : ''}</div>`;
                        
                        getWeather(lat, lon);
                    } else {
                        getWeather(lat, lon);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—Ç–∞:', error);
                    getWeather(lat, lon);
                });
        }

        function getWeather(lat, lon) {
            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=ru&appid=${apiKey}`)
                .then(response => response.json())
                .then(weatherData => {
                    document.getElementById('weatherD').innerHTML = `üå§Ô∏è –ü–æ–≥–æ–¥–∞: ${weatherData.weather[0].description}`;
                    document.getElementById('temp').innerHTML = `üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${weatherData.main.temp.toFixed(1)}¬∞C`;
                    document.getElementById('feels_li').innerHTML = `üí≠ –û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫: ${weatherData.main.feels_like.toFixed(1)}¬∞C`;
                  
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', error);
                });
        }
    </script>
</body>

</html>
